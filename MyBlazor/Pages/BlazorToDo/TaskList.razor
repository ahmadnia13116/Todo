@using MyBlazor.Pages.ComponentsBlazorToDo
@inject IDialogService DialogService

<MudDropContainer T="TaskItem" Items="Tasks" ItemsSelector="@((item, dropzone) => item.DropZone == dropzone)" ItemDropped="TaskDropped" Class="d-flex flex-wrap flex-grow-1">
	<ChildContent>
		<MudDropZone T="TaskItem" Identifier="Drop Zone 1" Class="rounded mud-background-gray pa-6 ma-8 flex-grow-1">
			<MudText Typo="Typo.h6" Class="mb-4">in progress</MudText>
		</MudDropZone>

		<MudDropZone T="TaskItem" Identifier="Drop Zone 2" Class="rounded mud-background-gray pa-6 ma-8 flex-grow-1">
			<MudText Typo="Typo.h6" Class="mb-4">Done</MudText>
		</MudDropZone>
	</ChildContent>

	<ItemRenderer>
		<MudPaper Elevation="4" Class="pa-4 my-2" Style="cursor:pointer"
				  @onclick="() => Layout.OpenRightDrawer(context)">
			<MudStack Row="true" AlignItems="@AlignItems.Center" Class="align-center" Spacing="1">

				<MudText Class="ml-2" Style="@GetStyle(context)">
					@context.Title
				</MudText>

				<MudSpacer />

				<MudIconButton Icon="@Icons.Material.Filled.Delete"
							   Color="Color.Error"
							   Size="Size.Small"
							   OnClick="async _ => await OnDelete.InvokeAsync(context.Id)" />
			</MudStack>
		</MudPaper>
	</ItemRenderer>

</MudDropContainer>


@code {
	[CascadingParameter] public MainLayout Layout { get; set; } = default!;

	[Parameter] public List<TaskItem> Tasks { get; set; } = new();
	[Parameter] public EventCallback<Guid> OnDelete { get; set; }

	private string GetStyle(TaskItem t) =>
		t.IsCompleted ? "text-decoration: line-through; opacity:0.6;" : "";

	private void TaskDropped(MudItemDropInfo<TaskItem> dropItem)
	{
		if (dropItem?.Item is null || dropItem.DropzoneIdentifier is null)
			return;

		
		dropItem.Item.DropZone = dropItem.DropzoneIdentifier;
	}

}

